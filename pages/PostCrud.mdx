# Post Crud

this the most important part of the application is happend and it will add into most of the projects like allways it's
has the model , api , client

## model

create model in this route `app/models/Post.js`

```javascript
import mongoose, { Schema } from "mongoose";

mongoose.connect(process.env.MONGODB_URI);
mongoose.Promise = global.Promise;

const postSchema = new Schema(
  {
    title: String,
    imgurl: String,
    description: String,
    category: String,
    body: String,
  },
  {
    timestamps: true,
  }
);

const Post = mongoose.models.Post || mongoose.model("Post", postSchema);

export default Post;
```

## Api

### route 1

create that here `app/api/Posts/route.js`
first of all import model and NextResponse to handle the req and rws

```javascript
import Post from "../../models/Post";
import { NextResponse } from "next/server";
```

#### Get All Post

```javascript
export async function GET() {
  try {
    const posts = await Post.find();

    return NextResponse.json({ posts }, { status: 200 });
  } catch (err) {
    console.log(err);
    return NextResponse.json({ message: "Error", err }, { status: 500 });
  }
}
```

#### Post New Post

```javascript
export async function POST(req) {
  try {
    const body = await req.json();
    const ticketData = body.formData;

    await Post.create(ticketData);

    return NextResponse.json(
      { message: "پست با موفقیت ساخته شد" },
      { status: 201 }
    );
  } catch (err) {
    console.log(err);
    return NextResponse.json({ message: "Error", err }, { status: 500 });
  }
}
```

### route 1

create that here `app/api/Posts/[id]/route.js`
first of all import model and NextResponse to handle the req and rws

```javascript
import Post from "../../../models/Post";
import { NextResponse } from "next/server";
```

#### Get Single Post

```javascript
export async function GET(request, { params }) {
  const { id } = params;

  const foundTicket = await Post.findOne({ _id: id });
  return NextResponse.json({ foundTicket }, { status: 200 });
}
```

#### Update Post

```javascript
export async function PUT(req, { params }) {
  try {
    const { id } = params;

    const body = await req.json();
    const ticketData = body.formData;

    const updateTicketData = await Post.findByIdAndUpdate(id, {
      ...ticketData,
    });

    return NextResponse.json(
      { message: "پست مورد نظر با موفقیت بروز شد" },
      { status: 200 }
    );
  } catch (error) {
    console.log(error);
    return NextResponse.json({ message: "Error", error }, { status: 500 });
  }
}
```

#### Delete Post

```javascript
export async function DELETE(req, { params }) {
  try {
    const { id } = params;

    await Post.findByIdAndDelete(id);
    return NextResponse.json(
      { message: "پست مورد نظر با موفیقت حذف شد" },
      { status: 200 }
    );
  } catch (error) {
    console.log(error);
    return NextResponse.json({ message: "Error", error }, { status: 500 });
  }
}
```

## Client

### Get All post

components to get all the posts

```javascript
const AllPost = async () => {
  const API_URL = process.env.API_URL;

  try {
    const res = await fetch(`${API_URL}/api/Posts`, {
      cache: "no-store",
    });

    if (!res.ok) {
      throw new Error("Failed to fetch topics");
    }

    return res.json();
  } catch (error) {
    console.log("Error loading topics: ", error);
  }
};

export default AllPost;
```

### Get Single Post

for this I craeted single function to get one post like this

```javascript
"use client";
import { useState, useEffect } from "react";
import axios from "axios";
import { usePathname } from "next/navigation";

const SinglePost = () => {
  const pathname = usePathname();
  const id = pathname.slice(7);
  const [battle, setBattle] = useState();

  useEffect(() => {
    const fetchBattle = async () => {
      try {
        const response = await axios.get(`/api/Posts/${id}`);
        setBattle(response.data.foundTicket);
      } catch (error) {
        console.error("Error fetching battle:", error);
      }
    };

    fetchBattle();
  }, [id]);

  return battle;
};

export default SinglePost;
```

then use that in this route `app/(pages)/Posts/[id]/page.jsx`
inside the file we use like this

```javascript
import SinglePost from "../../../ui/home/SinglePost";
import PostSkelton from "./PostSkelton";
const Post = () => {
  const post = SinglePost();

  if (!post) {
    return <PostSkelton />;
  }
  return <p>{post.body}</p>;
};
```

also add skelton before get the data

### All post

here is the components to get all posts

```javascript
const AllPost = async () => {
  const API_URL = process.env.API_URL;

  try {
    const res = await fetch(`${API_URL}/api/Posts`, {
      cache: "no-store",
    });

    if (!res.ok) {
      throw new Error("Failed to fetch topics");
    }

    return res.json();
  } catch (error) {
    console.log("Error loading topics: ", error);
  }
};

export default AllPost;
```

and we use this when ever need like this

```javascript
const Posts = async () => {
  const data = await AllPost();

  if (!data?.posts) {
    return <p>No posts.</p>;
  }

  const posts = data.posts;
  return (
    <>
      {posts && (
        <>
          {posts.map((Post, _index) => (
            <PostTable id={_index} key={_index} ticket={Post} />
          ))}
        </>
      )}
    </>
  );
};
```
