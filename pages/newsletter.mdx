# Newsletter

## 3 steps to add Newsletter

- [model](#1model)
- [api](#2api)
- [client](#3client)

### 1.Model

create model in thie route `app/models/NewsletterSubscription.js`

```javascript
import mongoose, { Schema } from "mongoose";

mongoose.connect(process.env.MONGODB_URI);
mongoose.Promise = global.Promise;

const newsletterSubscriptionSchema = new Schema(
  {
    email: {
      type: String,
      required: true,
      unique: true,
      trim: true,
      lowercase: true,
    },
  },
  {
    timestamps: true,
  }
);

const NewsletterSubscription =
  mongoose.models.NewsletterSubscription ||
  mongoose.model("NewsletterSubscription", newsletterSubscriptionSchema);

export default NewsletterSubscription;
```

### 2.API

after that you need api to handel the crud

in mode we 2 file for have the crude

#### route 1

create this route here `app/api/Newsletter/route.js`

in this file is used to hadle get all the newsletter and post new newsletter

the first things is import the model and also called the NextResponse to handle req and res from
server

```javascript
import NewsletterSubscription from "../../models/NewsletterSubscription";
import { NextResponse } from "next/server";
```

##### Get all emails

then get all the data

```javascript
export async function GET() {
  try {
    const subscriptions = await NewsletterSubscription.find();

    return NextResponse.json({ subscriptions }, { status: 200 });
  } catch (err) {
    console.log(err);
    return NextResponse.json({ message: "Error", err }, { status: 500 });
  }
}
```

##### post email

in this function we first check that email coming from user is exist and if that email is new It's create new email

```javascript
export async function POST(req) {
  try {
    const body = await req.json();
    const { email } = body;

    const existingSubscription = await NewsletterSubscription.findOne({
      email,
    });
    if (existingSubscription) {
      return NextResponse.json(
        { message: "ایمیل قبلاً عضو شده است" },
        { status: 400 }
      );
    }

    // Create new subscription
    await NewsletterSubscription.create({ email });

    return NextResponse.json(
      { message: "به خبرنامه مگ نتی فای خوش آمدید" },
      { status: 201 }
    );
  } catch (err) {
    console.log(err);
    return NextResponse.json({ message: "Error", err }, { status: 500 });
  }
}
```

#### route 2

the path of this file is different from the path of the first one you need to create route file here `app/api/Newsletter/[id]/route.js`

like before you need to import the model and NextResponse to handle the req and res like this

```javascript
import NewsletterSubscription from "../../../models/NewsletterSubscription";
import { NextResponse } from "next/server";
```

##### Delete email

```javascript
export async function DELETE(req, { params }) {
  try {
    const { id } = params;

    await NewsletterSubscription.findByIdAndDelete(id);
    return NextResponse.json(
      { message: "Newsletter Deleted" },
      { status: 200 }
    );
  } catch (error) {
    console.log(error);
    return NextResponse.json({ message: "Error", error }, { status: 500 });
  }
}
```

### 3.client

for the client is depent where user want to add the newsletter but in the common we add the newsletter at the end of the post
near to footer as componenets

```javascript
"use client";
import React, { useState } from "react";
import SiteConfig from "../../config/site";
const Newsletter = () => {
  const [email, setEmail] = useState("");
  const [message, setMessage] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      const response = await fetch("/api/Newsletter", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ email }),
      });

      const data = await response.json();

      if (response.ok) {
        setMessage(data.message);
        setEmail("");
      } else {
        setMessage(data.message);
      }
    } catch (error) {
      console.error("Error:", error);
      setMessage("خطایی رخ داد. لطفاً بعداً دوباره امتحان کنید.");
    }
  };
  return (
    <div>
      <div className="mx-auto">
        <div className="relative isolate overflow-hidden  px-6 py-24   sm:px-24 xl:py-32">
          <h2 className="mx-auto max-w-2xl text-center text-3xl font-bold tracking-tight text-black dark:text-white sm:text-4xl">
            عضویت در خبرنامه
          </h2>
          <p className="mx-auto mt-2 max-w-xl text-center text-lg leading-8 text-gray-700 dark:text-gray-300">
            {SiteConfig.description}
          </p>
          {message && (
            <p className="mx-auto mt-2 max-w-xl text-center text-lg leading-8 text-gray-700 dark:text-gray-300">
              {message}
            </p>
          )}
          <form
            className="mx-auto mt-10 flex max-w-md gap-x-4"
            onSubmit={handleSubmit}
          >
            <label htmlFor="email-address" className="sr-only">
              ایمیل
            </label>
            <input
              id="email-address"
              name="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="min-w-0 flex-auto rounded-md border-0 bg-white/5 px-3.5 py-2 text-black dark:text-white shadow-xl ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-white sm:text-sm sm:leading-6"
              placeholder="ایمیل"
            />
            <button
              type="submit"
              className="flex-none rounded-md bg-black dark:bg-white px-3.5 py-2.5 text-sm font-semibold text-gray-100 dark:text-gray-900 shadow-sm hover:bg-gray-900 dark:hover:bg-gray-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white"
            >
              ارسال
            </button>
          </form>

          <svg
            viewBox="0 0 1024 1024"
            className="absolute left-1/2 top-1/2 -z-10 h-[64rem] w-[64rem] -translate-x-1/2"
            aria-hidden="true"
          >
            <circle
              cx="512"
              cy="512"
              r="512"
              fill="url(#759c1415-0410-454c-8f7c-9a820de03641)"
              fill-opacity="0.7"
            ></circle>
            <defs>
              <radialGradient
                id="759c1415-0410-454c-8f7c-9a820de03641"
                cx="0"
                cy="0"
                r="1"
                gradientUnits="userSpaceOnUse"
                gradientTransform="translate(512 512) rotate(90) scale(512)"
              >
                <stop stop-color="#7775D6"></stop>
                <stop offset="1" stop-color="#7ED321" stop-opacity="0"></stop>
              </radialGradient>
            </defs>
          </svg>
        </div>
      </div>
    </div>
  );
};

export default Newsletter;
```
